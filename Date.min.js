/**
 * Date instance methods
 *
 * @author Ken Snyder (ken d snyder at gmail dot com)
 * @date 2010-07-01
 * @version 2.1 (http://kendsnyder.com/sandbox/date/)
 * @license Creative Commons Attribution License 3.0 (http://creativecommons.org/licenses/by/3.0/)
 */
(function(global){var day=24*60*60*1000;function zeroPad(number,digits){number=number+"";var cnt=digits-number.length;if(cnt<=0){return number}return Array(cnt+1).join("0")+number}function extend(d,s){for(var p in s){if(Object.prototype.hasOwnProperty.call(s,p)){d[p]=s[p]}}}var multipliers={millisecond:1,second:1000,minute:60*1000,hour:60*60*1000,day:day,week:7*day,month:{add:function addMonth(d,number){multipliers.year.add(d,Math[number>0?"floor":"ceil"](number/12));var prevMonth=d.getMonth()+(number%12);if(prevMonth==12){prevMonth=0;d.setYear(d.getFullYear()+1)}else{if(prevMonth==-1){prevMonth=11;d.setYear(d.getFullYear()-1)}}d.setMonth(prevMonth)},diff:function diffMonth(d1,d2){var diffYears=d1.getFullYear()-d2.getFullYear();var diffMonths=d1.getMonth()-d2.getMonth()+(diffYears*12);var diffDays=d1.getDate()-d2.getDate();return diffMonths+(diffDays/30)}},year:{add:function addYear(d,number){d.setYear(d.getFullYear()+Math[number>0?"floor":"ceil"](number))},diff:function diffYear(d1,d2){return multipliers.month.diff(d1,d2)/12}}};var m=multipliers;m.milliseconds=m.millisecond;m.seconds=m.second;m.minutes=m.minute;m.hours=m.hour;m.weeks=m.week;m.days=m.day;m.months=m.month;m.years=m.year;var instanceMethods={succ:function succ(unit){return this.clone().add(1,unit)},add:function add(number,unit){var factor=multipliers[unit]||multipliers.day;if(typeof factor=="number"){this.setTime(this.getTime()+(factor*number))}else{factor.add(this,number)}return this},diff:function diff(dateObj,unit,allowDecimal){dateObj=Date.create(dateObj);if(dateObj===null){return null}var factor=multipliers[unit]||multipliers.day;if(typeof factor=="number"){var unitDiff=(this.getTime()-dateObj.getTime())/factor}else{var unitDiff=factor.diff(this,dateObj)}return(allowDecimal?unitDiff:Math[unitDiff>0?"floor":"ceil"](unitDiff))},_applyFormat:function _applyFormat(formatStr,formatting){var source=formatStr||formatting.defaultFormat,result="",match;while(source.length>0){if(match=source.match(formatting.matcher)){result+=source.slice(0,match.index);result+=(match[1]||"")+this._applyFormatChar(match[2],formatting);source=source.slice(match.index+match[0].length)}else{result+=source,source=""}}return result},_applyFormatChar:function _applyFormatChar(code,formatting){if(formatting.shortcuts[code]){return this._applyFormat(formatting.shortcuts[code],formatting)}else{var getter=(formatting.codes[code]||"").split(".");var nbr=this["get"+getter[0]]?this["get"+getter[0]]():"";if(getter[1]){nbr=zeroPad(nbr,getter[1])}return nbr}},format:function format(formatStr){formatStr=formatStr||Date.formatting.strftime.defaultFormat;if(formatStr.indexOf("%")>-1){return this.strftime(formatStr)}return this.formatPhp(formatStr)},getShortYear:function getShortYear(){return this.getYear()%100},getMonthNumber:function getMonthNumber(){return this.getMonth()+1},getMonthName:function getMonthName(){return Date.MONTHNAMES[this.getMonth()]},getAbbrMonthName:function getAbbrMonthName(){return Date.ABBR_MONTHNAMES[this.getMonth()]},getDayName:function getDayName(){return Date.DAYNAMES[this.getDay()]},getAbbrDayName:function getAbbrDayName(){return Date.ABBR_DAYNAMES[this.getDay()]},getDayOrdinal:function getDayOrdinal(){return Date.ORDINALNAMES[this.getDate()%10]},getHours12:function getHours12(){var hours=this.getHours();return hours>12?hours-12:(hours==0?12:hours)},getAmPm:function getAmPm(){return this.getHours()>=12?"PM":"AM"},getAmPmLower:function getAmPmLower(){return this.getHours()>=12?"pm":"am"},getUnix:function getUnix(){return Math.round(this.getTime()/1000,0)},getUTCOffset:function getUTCOffset(){var hours=this.getTimezoneOffset()/60;var prefix=hours<0?"+":"-";hours=Math.abs(hours);return prefix+zeroPad(Math.floor(hours),2)+":"+zeroPad((hours%1)*60,2)},setUTCOffset:function setUTCOffset(seconds){var curr=this.getTimezoneOffset();var utcNow=this.getTime()+(curr*60000);this.setTime(utcNow-(seconds*60000));return this},getUTCOffsetDigits:function getUTCOffsetDigits(){return this.getUTCOffset().replace(":","")},getTimezoneName:function getTimezoneName(){var match=/(?:\((.+)\)$| ([A-Z]{3}) )/.exec(this.toString());return match[1]||match[2]||"GMT"+this.getUTCOffset()},toYmdInt:function toYmdInt(){return(this.getFullYear()*10000)+(this.getMonthNumber()*100)+this.getDate()},clone:function clone(){return new Date(this.getTime())},diffText:function diffText(){var seconds=this.diff(Date.current(),"seconds");var diff=Math.abs(seconds);var rawText;if(diff<120){return seconds>=0?"in a moment":"moments ago"}else{if(diff<3600){rawText=floor(diff/60)+" minutes"}else{if(diff<86400){var hours=floor(diff/3600);var s=hour==1?"":"s";rawText=hours+" hour"+s+" ago"}else{if(diff<172800){return seconds>0?"tomorrow":"yesterday"}else{if(diff<604800){rawText=floor(diff/86400)+" days"}else{if(diff<1209600){return seconds>0?"next week":"last week"}else{if(diff<2419200){rawText=floor(diff/604800)+" weeks"}else{if(diff<5184000){return seconds>0?"next month":"last month"}else{if(diff<31536000){rawText=floor(diff/2592000)+" months"}else{if(diff<63072000){return seconds>0?"next year":"last year"}else{rawText=floor(diff/31536000)+" years"}}}}}}}}}}return seconds>0?"in "+rawText:rawText+" ago"}};extend(Date.prototype,instanceMethods);if(!Date.prototype.toISOString){Date.prototype.toISOString=function toISOString(){return this.setUTCOffset(0).strftime(Date.ISO)}}var staticMethods={create:function create(date){if(typeof date=="undefined"){return Date.current()}if(date instanceof Date){return date}var a=arguments;switch(a.length){case 1:if(Object.prototype.toString.call(date)=="[object Number]"){return new Date(date)}var date=String(date).replace(/^\s*(.*)\s*$/,"$1");if(date===""){return Date.current()}var i=0,pattern,ms,obj,match;while((pattern=Date.create.patterns[i++])){if(!(match=date.match(pattern[0]))){continue}if(typeof pattern[1]=="function"){obj=pattern[1](match,date);if(obj instanceof Date){return obj}}else{ms=Date.parse(date.replace(pattern[0],pattern[1]));if(!isNaN(ms)){return new Date(ms)}}}return NaN;case 2:return new Date(a[0],a[1],1);case 3:return new Date(a[0],a[1],a[2]);case 4:return new Date(a[0],a[1],a[2],a[3]);case 5:return new Date(a[0],a[1],a[2],a[3],a[4]);case 6:return new Date(a[0],a[1],a[2],a[3],a[4],a[5]);default:return new Date(a[0],a[1],a[2],a[3],a[4],a[5],a[6])}},MONTHNAMES:"January February March April May June July August September October November December".split(" "),ABBR_MONTHNAMES:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),DAYNAMES:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ABBR_DAYNAMES:"Sun Mon Tue Wed Thu Fri Sat".split(" "),ORDINALNAMES:"th st nd rd th th th th th th".split(" "),ISO:"%Y-%m-%dT%H:%M:%S.%N%G",SQL:"%Y-%m-%d %H:%M:%S",SCRIPT_LOAD:new Date,daysInMonth:function daysInMonth(year,month){if(month==2){return new Date(year,1,29).getDate()==29?29:28}return[undefined,31,undefined,31,30,31,30,31,31,30,31,30,31][month]},autoFormat:function autoFormat(input,formatStr){input=typeof input=="string"?document.getElementById(input):input;function correct(){input.value=Date.create(input.value).format(formatStr)}if(input.attachEvent){input.attachEvent("onblur",correct)}else{if(input.addEventListener){input.addEventListener("blur",correct,false)}else{input.onblur=correct}}return input},addFormat:function addFormat(name,rules){Date.prototype[name]=function(formatStr){return this._applyFormat(formatStr,rules)}},current:function current(){return new Date}};extend(Date,staticMethods);if(!("now" in Date)){Date.now=function now(){return Date.current().setUTCOffset(0).getTime()}}Date.addFormat("strftime",{matcher:/()%(#?(%|[a-z]))/i,defaultFormat:"%Y-%m-%d %H:%M:%s",codes:{Y:"FullYear",y:"ShortYear.2",m:"MonthNumber.2","#m":"MonthNumber",B:"MonthName",b:"AbbrMonthName",d:"Date.2","#d":"Date",e:"Date",A:"DayName",a:"AbbrDayName",w:"Day",o:"DayOrdinal",H:"Hours.2","#H":"Hours",I:"Hours12.2","#I":"Hours12",P:"AmPmLower",p:"AmPm",M:"Minutes.2","#M":"Minutes",S:"Seconds.2","#S":"Seconds",s:"Unix",N:"Milliseconds.3","#N":"Milliseconds",O:"TimezoneOffset",Z:"TimezoneName",G:"UTCOffset"},shortcuts:{F:"%Y-%m-%d",T:"%H:%M:%S",X:"%H:%M:%S",x:"%m/%d/%y",D:"%m/%d/%y","#c":"%a %b %e %H:%M:%S %Y",v:"%e-%b-%Y",R:"%H:%M",r:"%I:%M:%S %p",t:"\t",n:"\n","%":"%"}});Date.addFormat("formatPhp",{matcher:/(\\)?([a-z])/i,defaultFormat:"Y-m-d H:i:s",codes:{Y:"FullYear",y:"ShortYear.2",m:"MonthNumber.2",n:"MonthNumber",F:"MonthName",M:"AbbrMonthName",d:"Date.2",j:"Date",l:"DayName",D:"AbbrDayName",w:"Day",S:"DayOrdinal",H:"Hours.2",G:"Hours",h:"Hours12.2",g:"Hours12",a:"AmPmLower",A:"AmPm",i:"Minutes.2",s:"Seconds.2",U:"Unix",Z:"TimezoneOffset",E:"TimezoneName",P:"UTCOffset",O:"UTCOffsetNumber"},shortcuts:{c:"Y-m-d\\TH:i:sP",r:"D, j M Y H:i:s O"}});var formatSql={matcher:/()(mi|am|pm|ss|yyyy|yy|m{1,4}|d{1,4}|w|hh?24|hh?12)/i,defaultFormat:"yyyy-mm-dd hh24:mi:ss",codes:{yyyy:"FullYear",yy:"ShortYear.2",mm:"MonthNumber.2",m:"MonthNumber",mmm:"AbbrMonthName",mmmm:"MonthName",dd:"Date.2",d:"Date",ddd:"AbbrDayName",dddd:"DayName",w:"Day",hh24:"Hours.2",h24:"Hours",hh12:"Hours12.2",h12:"Hours12",am:"AmPm",pm:"AmPm",mi:"Minutes.2",ss:"Seconds.2"},shortcuts:{}};var keys="yyyy yy mm m mmm mmmm dd d ddd dddd w hh24 h24 hh12 h12 am pm mi ss".split(" "),i=0,key;while((key=keys[i++])){formatSql.codes[key.toUpperCase()]=formatSql.codes[key]}Date.addFormat("formatSql",formatSql);Date.create.patterns=[[/^(?:(.+)\s+)?([01]\d|2[0-3])(?:\s*\:\s*([0-5]\d))(?:\s*\:\s*([0-5]\d))?\s*$/i,function pattern24Hour(match){var d;if(match[1]){d=Date.create(match[1]);if(isNaN(d)){return false}}else{d=Date.current();d.setMilliseconds(0)}d.setHours(parseFloat(match[2]),parseFloat(match[3]),parseFloat(match[4]||0));return d}],[/^(?:(.+)\s+)?([1-9]|1[012])(?:\s*\:\s*(\d\d))?(?:\s*\:\s*(\d\d))?\s*(am|pm)\s*$/i,function pattern12Hour(match){var d;if(match[1]){d=Date.create(match[1]);if(isNaN(d)){return false}}else{d=Date.current();d.setMilliseconds(0)}var hour=parseFloat(match[2]);hour=match[5].toLowerCase()=="am"?(hour==12?0:hour):(hour==12?12:hour+12);d.setHours(hour,parseFloat(match[3]||0),parseFloat(match[4]||0));return d}],[/(\d+)\s+(year|month|week|day|hour|minute|second)s?\s+(before|from|after)\s+(.+)/i,function patternAfter(match){var fromDate=Date.create(match[4]);if(fromDate instanceof Date){return fromDate.add((match[3].toLowerCase()=="before"?-1:1)*match[1],match[2])}return false}],[/([1-9]\d{3})\s*-\s*(1[0-2]|0\d|\d)\s*-\s*(3[01]|[0-2]\d|\d)/,"$2/$3/$1"],[/(1[0-2]|0\d|\d)\s*[\/-]\s*(3[01]|[0-2]\d|\d)\s*[\/-]\s*([1-9]\d{3})/,"$1/$2/$3"],[/(3[01]|[0-2]\d|\d)\s*[ -]\s*(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)\s*[ -]\s*([1-9]\d{3})/i,"$2 $1, $3"],[/(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*)\s+(3[01]|[0-2]\d|\d),?\s*([1-9]\d{3})/i,"$2 $1, $3"],[/(3[01]|[0-2]\d|\d)\s*\.\s*(1[0-2]|0\d|\d)\s*\.\s*([1-9]\d{3})/,"$2/$1/$3"],[/(\d+)\s+(year|month|week|day|hour|minute|second)s?\s+ago/i,function patternAgo(match){return Date.current().add(-1*match[1],match[2])}],[/in\s+(\d+)\s+(year|month|week|day|hour|minute|second)s?/i,function patternAfter(match){return Date.current().add(match[1],match[2])}],[/^(tod|now|tom|yes)/i,function patternToday(match){var now=Date.current();switch(match[1].toLowerCase()){case"tod":case"now":return now;case"tom":return now.add(1,"day");case"yes":return now.add(-1,"day")}}],[/(this|next|last)\s+(?:(year|month|week|day|hour|minute|second)|(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)|(sun|mon|tue|wed|thu|fri|sat))/i,function patternNext(match){var multiplier=match[1].toLowerCase()=="last"?-1:1;var now=Date.current();var months=Date.ABBR_MONTHNAMES;var i;if(match[2]){return now.add(multiplier,match[2])}else{if(match[3]){var month=match[3].toLowerCase();for(i=0;i<months.length;i++){if(month==months[i].toLowerCase()){return now.add(multiplier*(now.getMonth()+i),"month")}}}else{if(match[4]){var weekday=match[4].toLowerCase();var days=Date.ABBR_DAYNAMES;for(i=0;i<days.length;i++){if(weekday==days[i].toLowerCase()){return now.add(multiplier*(now.getDay()-i+7),"day")}}}}}}],[/^(?:(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)[a-z]*\s+)(?:the\s+)?(\d+)(?:st|nd|rd|th)?$/i,function patternNth(match){var d=Date.current();if(match[1]){var i=Date.ABBR_MONTHNAMES.length;while(i--){if(Date.ABBR_MONTHNAMES[i].toLowerCase()==match[1].toLowerCase()){d.setMonth(i);break}}}d.setDate(match[2]);return d}]];global.ProtoLove=global.ProtoLove||{};global.ProtoLove.$D=Date.create;global.$D=global.$D||Date.create;var addMonth=null,diffmonth=null,addYear=null,diffYear=null,add=null,diff=null,_applyFormat=null,_applyFormatChar=null,format=null,getShortYear=null,getMonthName=null,getMonthNumber=null,getAbbrMonthName=null,getDayOrdinal=null,getHours12=null,getAmPm=null,getAmPmLower=null,getUnix=null,getUTCOffset=null,setUTCOffset=null,getTimezoneName=null,toYmdInt=null,clone=null,diffText=null,toISOString=null,create=null,daysInMonth=null,autoFormat=null,addFormat=null,current=null,now=null,pattern24Hour=null,pattern12Hour=null,patternAgo=null,patternAfter=null,patternToday=null,patternNext=null,patternNth=null})(this);
